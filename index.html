<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>忍術バトル 上級者用</title><style>
body{font-family:sans-serif;text-align:center;background:#1a1a1a;color:#fff;margin:0;overflow:hidden;height:100vh;display:flex;flex-direction:column}
#start-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:center}
.mode-btn{width:250px;padding:20px;margin:10px;font-size:1.2rem;background:#e74c3c;color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:700}
.player-area{height:40%;display:flex;flex-direction:column;justify-content:center;padding:10px;transition:opacity .3s}
#p2-area{transform:rotate(180deg);border-bottom:2px solid #444}#p1-area{border-top:2px solid #444}
.hand{display:flex;justify-content:center;gap:5px;flex-wrap:wrap}
.card[data-type="火"]{background:#d32f2f}.card[data-type="水"]{background:#1976d2}.card[data-type="土"]{background:#f57c00}.card[data-type="風"]{background:#388e3c}.card[data-type="雷"]{background:#fbc02d}
.card{width:60px;height:85px;border:2px solid #fff;border-radius:5px;position:relative;cursor:pointer;transition:0.2s}
.card.selected{transform:translateY(-15px);border-color:#f1c40f;box-shadow:0 0 10px #f1c40f}
.card img{width:100%;height:70%;object-fit:cover;pointer-events:none}
.card-label{font-size:12px;font-weight:700;color:#fff;background:rgba(0,0,0,0.5)}
#battle-center{height:20%;background:rgba(0,0,0,.6);display:flex;flex-direction:column;align-items:center;justify-content:center;border-top:1px solid #555;border-bottom:1px solid #555}
.waiting{opacity:.2;pointer-events:none}
#flash-div{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;pointer-events:none}
@keyframes flash{0%{background:rgba(255,255,255,0)}50%{background:rgba(255,255,255,.8)}100%{background:rgba(255,255,255,0)}}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:100}
</style></head><body>
<div id="start-screen"><h1>忍術性質変化バトル</h1><button class="mode-btn" onclick="startGame('COM')">一人で遊ぶ</button><button class="mode-btn" onclick="startGame('PVP')">二人で遊ぶ</button></div>
<div id="flash-div"></div>
<div id="p2-area" class="player-area"><div id="p2-hand" class="hand"></div><button id="p2-btn" onclick="confirmMove(2)">決定</button></div>
<div id="battle-center"><div id="status-msg">いざ、尋常に…</div><div id="score-line">P1: 0点 | P2: 0点</div><div id="last-moves"></div></div>
<div id="p1-area" class="player-area"><button onclick="confirmMove(1)">決定</button><div id="p1-hand" class="hand"></div></div>
<div id="overlay" class="modal"><h2>交代してください</h2><button onclick="closeOverlay()">準備完了</button></div>
<script>
const icons={'火':'https://livedoor.blogimg.jp/pokeruto_narutostorm/imgs/9/d/9df794cc.png','水':'https://ooyake01.com/wp-content/uploads/2019/07/%E6%89%89%E9%96%93.png','土':'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQgUZKzoGoqlDT7mUC9X8fE76pwS8yTZOsQJWSf0JLyzQ&s=10','風':'https://otakotaku.com/asset/img/character/2017/10/uzumaki-naruto-59dbafb3a0d9ep.jpg','雷':'https://images-na.ssl-images-amazon.com/images/I/71rse6gO0XL._CR550,250,1420,1420_.jpg'},rel={'火':'風','風':'雷','雷':'土','土':'水','水':'火'},winAgainst={'風':'火','雷':'風','土':'雷','水':'土','火':'水'};
let hands,scores,selected,confirmed,turn,gameMode,p1Data,p2Data,firstPointPlayer=null;
function startGame(m){gameMode=m;document.getElementById('start-screen').style.display='none';initGame();}
function initGame(){
    hands={1:['火','水','土','風','雷'],2:['火','水','土','風','雷']};scores={1:0,2:0};selected={1:[],2:[]};confirmed={1:!1,2:!1};turn=1;firstPointPlayer=null;
    document.getElementById('p2-btn').style.display=(gameMode==='COM')?'none':'block';renderHands();unlockArea(1);unlockArea(2);
}
function renderHands(){
    for(let p=1;p<=2;p++){
        const t=document.getElementById(`p${p}-hand`);t.innerHTML="";
        if(gameMode==='COM'&&p===2){hands[p].forEach(()=>{const e=document.createElement("div");e.className="card";e.style.background="#555";t.appendChild(e);});}
        else{hands[p].forEach(n=>{const a=selected[p].includes(n),o=document.createElement("div");o.className=`card ${a?"selected":""}`;o.dataset.type=n;o.innerHTML=`<img src="${icons[n]}"><div class="card-label">${n}</div>`;o.onclick=()=>{if(!confirmed[p]){a?selected[p]=selected[p].filter(x=>x!==n):selected[p].push(n);renderHands();}};t.appendChild(o);});}
    }
    document.getElementById('score-line').innerText=`P1: ${scores[1]}点 | P2: ${scores[2]}点`;
}
function confirmMove(p){
    if(selected[p].length===0)return;
    if(selected[p].length===2&&!(selected[p].includes('水')&&selected[p].includes('風')))return alert("2枚出しは氷遁のみ");
    if(selected[p].length===3&&!(selected[p].includes('火')&&selected[p].includes('風')&&selected[p].includes('土')))return alert("3枚出しは塵遁のみ");
    if(p===1)p1Data=[...selected[1]];else p2Data=[...selected[2]];
    confirmed[p]=!0;selected[p]=[];renderHands();lockArea(p);
    if(confirmed[1]){if(gameMode==='COM')setTimeout(comTurn,500);else if(confirmed[2])battle();else showOverlay();}
}
function comTurn(){
    const h=hands[2],t=hands[1];let c=[];
    if(h.includes('火')&&h.includes('風')&&h.includes('土'))c=['火','風','土'];
    else if(h.includes('水')&&h.includes('風')&&Math.random()>0.5)c=['水','風'];
    else{let a=t.map(x=>winAgainst[x]).filter(x=>h.includes(x));c=a.length>0?[a[Math.floor(Math.random()*a.length)]]:[h[Math.floor(Math.random()*h.length)]];}
    p2Data=c;confirmed[2]=!0;battle();
}
function battle(){
    const m1=p1Data.sort(),m2=p2Data.sort();let win=0;
    if(m1.length>m2.length)win=1;else if(m2.length>m1.length)win=2;
    else if(m1.length===1){if(rel[m1[0]]===m2[0])win=1;else if(rel[m2[0]]===m1[0])win=2;}
    const f=document.getElementById('flash-div');f.style.animation='none';setTimeout(()=>{f.style.animation='flash 0.4s'},10);
    if(win!==0){
        scores[win]++;if(firstPointPlayer===null)firstPointPlayer=win;
        m1.forEach(c=>hands[1].splice(hands[1].indexOf(c),1));m2.forEach(c=>hands[2].splice(hands[2].indexOf(c),1));
        document.getElementById('status-msg').innerText=`P${win}の勝利！`;
    }else{
        if(m1.join("")===m2.join("")&&turn===1){document.getElementById('status-msg').innerText="あいこやり直し";}
        else{m1.forEach(c=>hands[1].splice(hands[1].indexOf(c),1));m2.forEach(c=>hands[2].splice(hands[2].indexOf(c),1));document.getElementById('status-msg').innerText="引き分け";}
    }
    document.getElementById('last-moves').innerHTML=`P1:${m1.join("+")} vs P2:${m2.join("+")}`;
    turn++;renderHands();
    if(scores[1]>=2||scores[2]>=2||hands[1].length===0||hands[2].length===0)setTimeout(judgeFinal,800);
    else{confirmed={1:!1,2:!1};unlockArea(1);unlockArea(2);}
}
function judgeFinal(){
    let w=0;
    if(scores[1]!==scores[2])w=scores[1]>scores[2]?1:2;
    else if(hands[1].length!==hands[2].length)w=hands[1].length>hands[2].length?1:2;
    else w=firstPointPlayer;
    alert(`【試合終了】勝者: プレイヤー${w}\n(判定理由: ${scores[1]===scores[2]?(hands[1].length===hands[2].length?'先取判定':'手札残数判定'):'ポイント差'})`);
    document.getElementById('start-screen').style.display='flex';
}
function lockArea(p){document.getElementById(`p${p}-area`).classList.add('waiting')}
function unlockArea(p){document.getElementById(`p${p}-area`).classList.remove('waiting')}
function showOverlay(){document.getElementById('overlay').style.display='flex'}
function closeOverlay(){document.getElementById('overlay').style.display='none'}
</script></body></html>
